# Kustomize Overlay: Production Environment
#
# Production configuration - matches staging for consistency.
# Uses percolationlabs/rem:latest from Docker Hub.
#
# Features:
#   - PostgreSQL: 2 replicas, 100Gi gp3-postgres storage (5000 IOPS)
#   - API: percolationlabs/rem:latest (3 replicas for HA)
#   - High resource allocations
#
# Usage:
#   kubectl apply -k manifests/application/rem-stack/overlays/prod

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Reference base configuration
resources:
  - ../../base
  - ../../components/postgres

# Namespace: rem-api (inherited from base)

# Environment labels
commonLabels:
  environment: production

# Note: percolationlabs/rem:latest is used directly in component manifests

# ConfigMap generator for production environment
configMapGenerator:
  - name: rem-version-info
    behavior: merge
    literals:
      - VERSION=latest
      - ENVIRONMENT=production
      - GIT_COMMIT=${GIT_COMMIT:-unknown}
      - BUILD_DATE=${BUILD_DATE:-unknown}
      - LOG_LEVEL=INFO

# Patches for production environment
patches:
  - path: api-patch.yaml
  - path: worker-patch.yaml
  - path: postgres-patch.yaml

# Scale replicas for HA
replicas:
  - name: rem-api
    count: 3

# Labels for version tracking
labels:
  - pairs:
      app.kubernetes.io/version: latest
    includeSelectors: true
    includeTemplates: true
