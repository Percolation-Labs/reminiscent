# ExternalSecret for PostgreSQL bootstrap credentials
#
# CNPG uses this secret to set up the initial database owner credentials.
# The password is stored in AWS SSM Parameter Store.

apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: rem-database-credentials
spec:
  refreshInterval: 1h

  secretStoreRef:
    name: aws-parameter-store
    kind: ClusterSecretStore

  target:
    name: rem-database-credentials
    creationPolicy: Owner

  data:
    # Username matches the 'owner' in postgres-cluster.yaml bootstrap.initdb
    - secretKey: username
      remoteRef:
        key: /siggy/postgres/username
        decodingStrategy: None
    # Password from SSM
    - secretKey: password
      remoteRef:
        key: /siggy/postgres/password
        decodingStrategy: None
