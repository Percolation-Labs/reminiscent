# REM Stack Cluster Configuration
# ================================
# This file defines all configuration for deploying a REM stack to Kubernetes.
# Copy this file and customize for your environment.
#
# Usage:
#   1. Copy to your deployment: cp cluster-config.yaml my-cluster-config.yaml
#   2. Edit values for your environment
#   3. Generate manifests: rem cluster generate --config my-cluster-config.yaml
#   4. Apply to cluster: kubectl apply -k manifests/application/rem-stack/overlays/staging
#
# Alternatively, set environment variables (they override this file):
#   export REM_PROJECT_NAME=myproject
#   export REM_GIT_REPO_URL=https://github.com/myorg/myrepo.git

# =============================================================================
# PROJECT CONFIGURATION
# =============================================================================
project:
  # Project name - used as prefix for all resources (namespaces, roles, buckets)
  # Default: rem
  name: rem

  # Environment: dev, staging, production
  environment: staging

  # Kubernetes namespace for application workloads
  # Default: same as project name
  namespace: rem

# =============================================================================
# GIT REPOSITORY
# =============================================================================
git:
  # Git repository URL for ArgoCD to sync from
  repoURL: https://github.com/Percolation-Labs/reminiscent.git

  # Branch/tag/commit to deploy
  # Use 'main' for production, feature branches for testing
  targetRevision: main

  # Path to Kustomize overlay within the repo
  # Typically: manifests/application/rem-stack/overlays/{environment}
  path: manifests/application/rem-stack/overlays/staging

# =============================================================================
# AWS CONFIGURATION
# =============================================================================
aws:
  # AWS Region for all resources
  region: us-east-1

  # AWS Account ID (required for SQS URLs, IAM ARNs)
  accountId: ""  # Set via AWS_ACCOUNT_ID env var or fill in here

  # SSM Parameter Store prefix for secrets
  # All secrets are stored under this prefix:
  #   {ssmPrefix}/postgres/username
  #   {ssmPrefix}/postgres/password
  #   {ssmPrefix}/llm/anthropic-api-key
  #   {ssmPrefix}/llm/openai-api-key
  #   {ssmPrefix}/phoenix/api-key (optional)
  ssmPrefix: /rem

# =============================================================================
# INFRASTRUCTURE NAMES
# =============================================================================
# These are typically generated by CDK. Override if using existing resources.
infrastructure:
  # EKS cluster name (from CDK output: ClusterName)
  clusterName: rem-application-cluster-a

  # S3 bucket for application files (from CDK output: AppBucketName)
  appBucket: rem-io-staging

  # S3 bucket for PostgreSQL backups (from CDK output: PGBackupBucketName)
  backupBucket: rem-io-pg-backups-staging

  # SQS queue for file processing (from CDK output: FileProcessingQueueUrl)
  # Leave empty to auto-generate from cluster name
  fileQueueUrl: ""

  # SQS queue ARN for KEDA (from CDK output: FileProcessingQueueArn)
  fileQueueArn: ""

# =============================================================================
# PLATFORM OPERATORS
# =============================================================================
# Configuration for platform-level operators deployed via ArgoCD
platform:
  # External Secrets Operator
  externalSecrets:
    enabled: true
    namespace: external-secrets-system
    chartVersion: "0.20.4"  # Use HTTPS chart, not OCI
    chartRepo: https://charts.external-secrets.io

  # CloudNativePG Operator
  cloudnativePg:
    enabled: true
    namespace: cnpg-system
    chartVersion: "0.26.1"
    chartRepo: https://cloudnative-pg.github.io/charts
    # Disable PodMonitor unless Prometheus Operator is installed
    podMonitorEnabled: false

  # KEDA (Kubernetes Event-Driven Autoscaling)
  keda:
    enabled: true
    namespace: keda
    chartVersion: "2.16.1"
    chartRepo: https://kedacore.github.io/charts

  # Cert Manager
  certManager:
    enabled: true
    namespace: cert-manager
    chartVersion: "v1.16.2"

  # OpenTelemetry Operator
  opentelemetry:
    enabled: true
    namespace: opentelemetry-operator-system
    # Use cert-manager for webhook certs (more reliable than auto-generate)
    useCertManager: true

# =============================================================================
# POSTGRESQL CONFIGURATION
# =============================================================================
postgres:
  # Cluster name (becomes service name: {name}-rw, {name}-ro)
  clusterName: rem-postgres

  # Number of instances (1 for dev, 3 for HA)
  instances: 3

  # Database name for REM application
  database: remdb

  # Database owner username
  owner: remuser

  # Additional databases to create (e.g., for Phoenix)
  additionalDatabases:
    - phoenixdb

  # Storage class: gp3 (dev), gp3-postgres (prod), io2-postgres (mission-critical)
  storageClass: gp3

  # Storage size
  storageSize: 50Gi

  # Resource requests/limits
  resources:
    requests:
      memory: 4Gi
      cpu: "2000m"
    limits:
      memory: 8Gi
      cpu: "4000m"

  # Enable backups to S3
  backupEnabled: true
  backupRetentionDays: 30

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================
application:
  # Container image registry (DockerHub, ECR, GHCR)
  imageRegistry: percolationlabs

  # Image pull policy: Always, IfNotPresent, Never
  imagePullPolicy: Always

  # API configuration
  api:
    replicas: 2
    image: percolationlabs/rem
    tag: latest
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 2Gi
        cpu: 1000m

  # Worker configuration
  worker:
    # Min replicas (0 = scale to zero when idle)
    minReplicas: 0
    maxReplicas: 20
    image: percolationlabs/rem
    tag: latest
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 2Gi
        cpu: 1000m

# =============================================================================
# OBSERVABILITY
# =============================================================================
observability:
  # Phoenix (Arize) for LLM observability
  phoenix:
    enabled: true
    # Phoenix needs its own database (phoenixdb) to avoid conflicts with REM
    database: phoenixdb

  # OpenTelemetry collector
  otel:
    enabled: true
    # Send traces to AWS X-Ray
    xrayEnabled: true
    # Send metrics to CloudWatch
    cloudwatchEnabled: true

# =============================================================================
# INGRESS CONFIGURATION
# =============================================================================
ingress:
  # Enable ingress (requires AWS Load Balancer Controller)
  enabled: true

  # Domain name for the API
  # Leave empty to use ALB DNS name
  domain: ""

  # TLS certificate ARN (from ACM)
  # Leave empty for HTTP only
  certificateArn: ""

  # Ingress class: alb (AWS), nginx, traefik
  className: alb

  # ALB scheme: internet-facing or internal
  scheme: internet-facing
